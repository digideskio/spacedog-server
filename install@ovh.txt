###
### Provision and install
###

# provision an ovh debian 7 server

# sets the server ip to ovh[n] in /private/etc/hosts of dev computer

# copy jdk to ovh server
scp server-jre-8u45-linux-x64.gz root@ovh1:/root/spacedog/install

# create ssl certificates

# convert private key to pkcs8
openssl pkcs8 -topk8 -nocrypt -in spacedog.io.rsa.private.key -outform DER -out spacedog.io.pkcs8.der

# copy ssl files to ssl server folder
scp spacedog...crt Gandi...pem spacedog...der root@ovh1:/root/spacedog/ssl

###
### Install JRE on ovh server
###
### J'ai suivi le tuto suivant
###
### https://www.digitalocean.com/community/tutorials/how-to-manually-install-oracle-java-on-a-debian-or-ubuntu-vps
###
###

# ssh to ovh server
ssh -l root ovh1

###
### Build and deploy
###

# package the soft
mvn -DskipTests clean package

# clean package on ovh server
# be careful to keep the magic/data folder
rm -r bin
rm install/spacedog-services-0.1.0-SNAPSHOT-bundle.tar.gz

# copy release to server
scp target/spacedog-services-0.1.0-SNAPSHOT-bundle.tar.gz root@ovh1:/root/spacedog/install

# untar
tar xvzf install/spacedog-services-0.1.0-SNAPSHOT-bundle.tar.gz

###
### copy ES data to ovh server
###

# tar data on any desktop or server
tar cvzf spacedog-elastic-data.gz data

# scp data to ovh server
scp spacedog-elastic-data.gz root@ovh1:/root/spacedog/install

# go to spacedog folder
cd spacedog

# remove old data
rm -r data

# untar 
tar xvzf /root/spacedog/install/spacedog-elastic-data.gz

###
### Run spacedog on ovh server
###

# go to spacedog folder on ovh server
cd /spacedog/bin

# sudo sinon permission denied
./start.sh

# to follow logs
tail -f log

