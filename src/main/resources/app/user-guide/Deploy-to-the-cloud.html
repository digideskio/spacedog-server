<!DOCTYPE html>
<html>

	<head>
	  <meta charset="utf-8"/>
	  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	  <meta name="viewport" content="width=device-width, initial-scale=1"/>

	  <title>SpaceZ documentation: Deploy to the cloud</title>
	  <meta name="description" content="Forget about server-side pain. Focus on creating amazing user experiences. Sign up and immediately access our backend services. Save and search for data. Edit and push new contents. Deploy and publish resources and services.
"/>

	  <meta name="author" content="David Attias"/>

	  <link rel="stylesheet" href="/css/spacez.css"/>
	  <link rel="stylesheet" href="/css/highlight.css"/>
	  
	  <link rel="icon" type="image/png" href="images/favicon.png"/>
	</head>

  <body>

	<header>
      <nav>
        <a class= "logo" href="/">SpaceZ</a>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/documentation.html">Documentation</a></li>
          <li><a class="button" href="/signin">Sign in</a></li>
        </ul>
      </nav>    
    </header>

    <menu>
		<h5>User's guide</h5>
		
    <ul>
      
			
       	<li>
          
          
            <a  href="/user-guide/Signing-up.html"> Signing up </a>
          
      </li>
     	
       	<li>
          
          
            <a  href="/user-guide/Storing-and-searching-data.html"> Storing and searching data </a>
          
      </li>
     	
       	<li>
          
          
            <a  href="/user-guide/Data-object-schema.html"> Data object schema </a>
          
      </li>
     	
       	<li>
          
            <a  class="active"  href="/user-guide/Deploy-to-the-cloud.html"> Deploy to the cloud --> </a>
          
          
      </li>
     	
       	<li>
          
          
            <a  href="/user-guide/Configurations-and-contents.html"> Configurations and contents </a>
          
      </li>
     	
    </ul>

   	</br>
    <h5>Reference's guide</h5>
		
    <ul>
      
        <li>
          
          
            <a  href="/reference-guide/Accounts.html"> Accounts </a>
          
        </li>
      
        <li>
          
          
            <a  href="/reference-guide/Batch.html"> Batch </a>
          
        </li>
      
        <li>
          
          
            <a  href="/reference-guide/Configuration.html"> Configuration </a>
          
        </li>
      
        <li>
          
          
            <a  href="/reference-guide/Contents.html"> Contents </a>
          
        </li>
      
        <li>
          
          
            <a  href="/reference-guide/Data.html"> Data </a>
          
        </li>
      
        <li>
          
          
            <a  href="/reference-guide/Files.html"> Files </a>
          
        </li>
      
        <li>
          
          
            <a  href="/reference-guide/Jobs.html"> Jobs </a>
          
        </li>
      
        <li>
          
          
            <a  href="/reference-guide/Logging.html"> Logging </a>
          
        </li>
      
        <li>
          
          
            <a  href="/reference-guide/PDF-&-Emails.html"> PDF & Emails </a>
          
        </li>
      
        <li>
          
          
            <a  href="/reference-guide/Queues.html"> Queues </a>
          
        </li>
      
        <li>
          
          
            <a  href="/reference-guide/Schema.html"> Schema </a>
          
        </li>
      
        <li>
          
          
            <a  href="/reference-guide/Services.html"> Services </a>
          
        </li>
      
        <li>
          
          
            <a  href="/reference-guide/Stash.html"> Stash </a>
          
        </li>
      
        <li>
          
          
            <a  href="/reference-guide/Users.html"> Users </a>
          
        </li>
      
    </ul>

    </menu>

    <div class="doc">

	    <p>Use the <code>/v1/file</code> endpoint to upload and publish files and file sets to the cloud.</p>

<p>Why would you do that?
- to publish and manage static resources,
- to publish a single page js app and all its resources,
- to upload and store user files,
- to store app generated reports and files,
- ...</p>

<h5>Publish a tgz file</h5>

<p>First create tgz archive with the right file tree, call it <code>myapp.tgz</code>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/myapp
|
|---- .settings.json
|---- main.js
|---- /images
|     |
|     |---- logo.png
|     |---- ...
|---- ...
</code></pre></div>
<p>Then send a <code>POST v1/file</code> with the tgz archive as multi part body and a <code>Content-type</code> header set to <code>???/???</code>. It returns a classic status JSON:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;success&quot;</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;lkjhgk876lklvfc67445hvbbljcdcgjm&quot;</span><span class="p">,</span>
  <span class="nt">&quot;location&quot;</span> <span class="p">:</span> <span class="s2">&quot;https://files.magicapps.com/{x-magic-app-id}/lkjhgk876lklvfc67445hvbbljcdcgjm/myapp&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>The returned location is the base location of the archive file tree. To access a specific file of the file tree, append the file relative path to the base location:</p>
<div class="highlight"><pre><code class="language-http" data-lang="http"><span class="err">https://files.magicapps.com/{x-magic-app-id}/lkjhgk876lklvfc67445hvbbljcdcgjm/myapp/main.js</span>
<span class="err">https://files.magicapps.com/{x-magic-app-id}/lkjhgk876lklvfc67445hvbbljcdcgjm/myapp/images/logo.png</span>
</code></pre></div>
<h5>Add a settings to your tgz file</h5>

<p>To change the way uploaded file sets are served, add a <code>.settings.json</code> file at the root of the tgz archive. Example:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
     <span class="nt">&quot;_default&quot;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;_cdn&quot;</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="nt">&quot;_purge&quot;</span> <span class="p">:</span> <span class="mi">786765</span><span class="p">,</span>
          <span class="nt">&quot;_headers&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;ttl&quot;</span> <span class="p">:</span> <span class="mi">5645</span>
          <span class="p">},</span>
          <span class="nt">&quot;_types&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;js&quot;</span> <span class="p">:</span> <span class="s2">&quot;application/js&quot;</span><span class="p">,</span>
               <span class="nt">&quot;png&quot;</span> <span class="p">:</span> <span class="s2">&quot;image/png&quot;</span>
          <span class="p">},</span>
          <span class="nt">&quot;_acl&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;public&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;read&quot;</span> <span class="p">:</span> <span class="kc">true</span>
               <span class="p">},</span>
               <span class="nt">&quot;admin&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;read&quot;</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nt">&quot;write&quot;</span> <span class="p">:</span> <span class="kc">true</span>
               <span class="p">}</span>
          <span class="p">}</span>
     <span class="p">},</span>
     <span class="nt">&quot;images&quot;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;_headers&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;ttl&quot;</span> <span class="p">:</span> <span class="mi">98778</span>
          <span class="p">}</span>
     <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><code>_default</code> contains the default file settings for this archive.</li>
<li><code>_cdn</code> If true, files are accessed through a CDN for better performance. Default to false.</li>
<li><code>_purge</code> Duration in milliseconds before this archive is purged since upload. O means no purge. Default is 0.</li>
<li><code>_headers</code> List of headers to set when serving this archive files.</li>
<li><code>_types</code> maps file extensions to content types. This allow the <code>Content-type</code> header to be automatically set when serving this archive files.</li>
<li><code>_acl</code> contains access control settings. Equivalent to data objects access control settings in schema.</li>
<li><code>images</code> contains the specific file settings for the <code>images</code> file tree. Do the same for all archive file or file tree that need specific settings. Specific and default settings are merged with specific overriding default fields.</li>
</ul>

<h5>Default file settings</h5>

<p>The system provides a default file settings JSON. When serving files, the system merges default and specific settings (if any) an archive might provided. The specific settings have precedence.</p>

<p>To get the default file settings, send a <code>GET /v1/file/settings</code> request. To update it, send a <code>PUT /v1/file/settings</code> request with a body set to the updated settings JSON.</p>

<h5>Publish a single file</h5>

<p>To upload and publish a single file, send a <code>POST /v1/file</code> with
- a file as multi part body,
- an optional <code>filename</code> query param,
- an optional <code>Content-type</code> header with the right value Mandatory if there is no filename or no known file extension at the end of the filename.</p>

<p>Filenames are not use to uniquely identify uploaded files. A unique generated identifier is attached to all uploaded files or archives. Use filenames to help humans debug or manage since filenames are visible in file locations.</p>

<h5>Attach a specific URL to a file or file tree</h5>

<p>You can use your own domain names to serve uploaded files and file trees. The domain names must first be attached to your app with the help of the Magic Console.</p>

<p>Then to attach your file or file tree to a specific domain and URI, send a <code>PUT /v1/url/{hostname}/{port}/{uri}</code> request with a <code>fileId</code> query param set the the uploaded file/archive identifier. <code>port</code> and <code>uri</code> can be empty. It returns the following JSON:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
     <span class="nt">&quot;success&quot;</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
     <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;lkjhhg98776jkhkgvhgcftyc9078T&quot;</span><span class="p">,</span>
     <span class="nt">&quot;location&quot;</span> <span class="p">:</span> <span class="s2">&quot;https://{hostname}:{port}/{uri}&quot;</span>
<span class="p">}</span>
</code></pre></div>

    </div>
  </body>
</html>
